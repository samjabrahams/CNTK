# This script downloads 40 public-domain images from the New York Public
# Library Digital Collections to the script's directory. See
#
#   http://digitalcollections.nypl.org/collections/chinese-water-color-paintings
#
# for the original source. We'll verify the SHA1 for each image to make sure the
# right images are downloaded.
[CmdletBinding()]Param()

$directory = Split-Path $MyInvocation.MyCommand.Path

# Download unless present

1564068 .. 1564107 | % {
    $file = Join-Path $directory "image.nypl.org-$_.jpg"
    if (Test-Path $file) {
        Write-Verbose "$file already downloaded"
    } else {
        Write-Verbose "Downloading $_"
        Invoke-WebRequest -OutFile $file "http://images.nypl.org/index.php?id=$_&t=w&download=1"
    }
    if (-not (Test-Path $file -PathType Leaf)) {
        throw "?Could not download $_"
    }
}

# Really check we've got the right set of images

$expectedSha1 = Write-Output `
    79207179BDC2C4B55257D78F19EC91750E76CEEE `
    58ABD35E466020726C22A69C82C5321277B41ACA `
    31AC459371A6AAE1DFD75515EF309DD7407D35C2 `
    9A9B928856C8711A5FDA599B52ABB8E66CA1234A `
    6D64F723AE7AF7021F3C4D5C870A78F810581FFF `
    74D34B0C9E2AB94692F4C882BE1BE964D77C2CF7 `
    700044BF8BB77B47B4CF12FD94527992A451BB8E `
    BF60592A62DD14B90C459489C1F845DB251B8133 `
    C3B8D2ACE1A4A8239B8676429CD0E89D686880DD `
    7A8A66BCE4B44C4ABE02AAB341F8DFDE1DCDE69D `
    1C9733BABA3A6DF09CBEB9F62A32E2B3E4365737 `
    A13827F3CEE6C24977D8E02FE3A4B18ABDE2F2A8 `
    FCB1B061002F91DE60BAE70FDD209C8AAEFFA045 `
    01C29765427E7FE4FC6BC3EDA504841B8E0A693F `
    316B39BD01A9F615DB436C552A6ED7B6C9B98570 `
    0948C0781A18562CB234EECEE71D10310E8132B6 `
    AC24267CDF5EC9F201457A287CFC3E35A6F5B3CE `
    5EE7E1D88334BE3954D6CDF775B7F9B3E541532D `
    C3C635C13BF617F756A4D903DFC4AA7DCF8E942F `
    D90D5BA9BA624FE61FD469435708FE19054E21AD `
    8376E7DE032F217DFAA565D7FB073A69A1BD040B `
    B283A2D9B7BF933A52F7D2BD60C42B2B00109C17 `
    7934F50A20890C5E8E73A388679A0C3EB001A9A3 `
    D6DCB7D791B32213AAA46DEAE82F888B5BD2EDB1 `
    F8616B77B5ECE25B84D6F8F68D6C7C1AB6B82AF0 `
    E359FC599F1954E8195A56A4513D437E7C1B588B `
    27A0445ABBAF44AC6F631E2D8BD6F0C0B6837123 `
    090C661D6EAC4A395AC8B850D0A79090CA687ED0 `
    C87319C25726FA0E8BC3FEE8BCA01DBBC26E24F3 `
    0975268B8CC3297D247CBEAACEDA13D9F01FAB00 `
    143A4AEAEEFF91E565CEEBC7D65D20375F809EA2 `
    0E17CF258FE40B01A0C7308707AB20F234BA49FB `
    B9D12195316F2E2DE7570891CC7B9F458F25D32F `
    CD9A22200A73E474FD796A55C6C47516CDB74066 `
    28C54D6A4F0A1B3E887261A32DFBB0C49C7DA698 `
    286D62F0A5F0179EC0598E0D39EE688EB3111538 `
    5FD9F1A6B43B1DC593DF17CA708525FC929D496F `
    0E904D4BA7110250F73D4015D9AC01CE4B284193 `
    94C03922A8B7D205668F8C2A6523962F642CE367 `
    91340522ABF47C41CDED1DE86C100C83651246EB

$actualSha1 = Get-Hash -Algorithm SHA1 (Join-Path $directory image.nypl.org-*jpg) | % HashString

if (Compare-Object $expectedSha1 $actualSha1) {
    throw "?These aren't the expected images."
}

Write-Verbose "Integrity of images checked"
